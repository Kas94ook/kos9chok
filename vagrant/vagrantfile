$script = <<-SCRIPT
sudo runuser -l vagrant -c 'cat /tmp/id_rsa.pub >> /home/vagrant/.ssh/authorized_keys'
rm -f /tmp/id_rsa.pub
SCRIPT

Vagrant.configure("2") do |config|
  config.vm.define "ubuntu0" do |node|
    node.vm.box = "ubuntu/jammy64"
    node.vm.hostname = "garya-ubuntu0"
    node.vm.network :private_network, ip: "192.168.56.101"

    node.vm.provider "virtualbox" do |vb|
      vb.name = "garya-centos"
      vb.gui = false
      vb.memory = 2048
      vb.cpus = 1

      node.vm.provision "shell", inline: <<-SHELL
        apt-get update
        apt-get install -y python3 python3-pip
        pip3 install ansible
      SHELL

      node.vm.provision "ansible" do |ansible|
        ansible.playbook = "ansible/playbooks/playbook.yaml"
        ansible.inventory_path = "ansible/inventory/hosts"
      end

      node.vm.provision "file", source: "~/.ssh/id_rsa.pub", destination: "/tmp/id_rsa.pub"
      node.vm.provision "shell", inline: $script
    end
  end
end
